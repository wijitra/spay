var $ = require('underscore');

var meta = {
    '00': {
        inputMatch: /\%(00)\,([a-z0-9A-Z]+)\=(\d{6})(\d)00\#/,
        outputMap: [
            ['version', 2],
            ['machineId', 3],
            ['status', 4]
        ]

    },
    '01': {
        inputMatch: /\%(01)(\d{2})(\d{2})\=(\d{10})00\#/,
        outputMap: [
            ['typemenu', 2],
            ['groupmenu', 3],
            ['mobilephone', 4]
        ]

    },
    '02':{
        inputMatch: /\%(02)\=(\d{1,4})\,(\d{1,4})00\#/,
        outputMap: [
            ['menu', 2],
            ['money', 3]         
        ]
    }
}

exports.parse = function(input) {
    var cmd = input.substring(1,3)
    var obj = meta[cmd];
    var result = input.match(obj.inputMatch)
    var ret = {
        command: cmd
    }
    $.each(obj.outputMap, function(item) {
        ret[item[0]] = result[item[1]]
    })
    return ret;
}